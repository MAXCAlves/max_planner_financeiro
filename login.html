<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Acesso - Max Planner Financeiro</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Estilo baseado na sua imagem de referência (Azul Profundo/Futurista) */
      .bg-dark-futuristic {
        background-color: #1e3a8a; /* Azul Profundo corporativo */
        background-image: linear-gradient(135deg, #1e3a8a 0%, #172554 100%);
      }
      .card-login {
        background-color: #ffffff;
      }
      /* Estilo para a mensagem de erro */
      .error-message {
        display: none;
        padding: 0.5rem;
        border-radius: 0.375rem;
        background-color: #fef2f2; /* Vermelho claro */
        border: 1px solid #f87171; /* Borda vermelha */
      }
      .success-message {
        display: none;
        padding: 0.5rem;
        border-radius: 0.375rem;
        background-color: #d1fae5; /* Verde claro */
        border: 1px solid #34d399; /* Borda verde */
      }
    </style>
  </head>
  <body class="bg-dark-futuristic flex items-center justify-center min-h-screen">
    <div class="w-full max-w-md card-login rounded-xl shadow-2xl p-8">
      <h1 class="text-3xl font-extrabold text-center text-blue-700 mb-2">
        MAX PLANNER
      </h1>
      <p class="text-center text-gray-500 mb-6 text-sm">
        Acesse sua conta e comece a planejar.
      </p>

      <!-- Área de Feedback de Erro/Sucesso (Recuperação de Senha) -->
      <p id="feedbackMessage" class="error-message text-red-600 mb-4"></p>

      <!-- Formulário de login com e-mail/senha -->
      <form id="loginForm" class="space-y-4">
        <div>
          <label for="email" class="block text-gray-700 text-sm font-medium"
            >E-mail</label
          >
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150"
          />
        </div>
        <div>
          <label for="password" class="block text-gray-700 text-sm font-medium"
            >Senha</label
          >
          <input
            type="password"
            id="password"
            name="password"
            required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150"
          />
          
          <!-- NOVO LINK DE RECUPERAÇÃO DE SENHA -->
          <button type="button" id="forgotPasswordBtn" class="text-xs text-blue-600 hover:underline mt-1 block text-right">
            Esqueci minha senha
          </button>
        </div>
        
        <button
          type="submit"
          class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition duration-200"
        >
          Entrar no Dashboard
        </button>
      </form>

      <div class="mt-6 space-y-3">
        <div class="relative flex items-center">
          <div class="flex-grow border-t border-gray-300"></div>
          <span class="flex-shrink mx-4 text-gray-400 text-sm">OU</span>
          <div class="flex-grow border-t border-gray-300"></div>
        </div>

        <!-- Login com Google -->
        <button
          id="googleLogin"
          type="button"
          class="w-full flex items-center justify-center border border-gray-300 bg-white text-gray-700 py-2 rounded-lg hover:bg-gray-100 transition duration-200"
        >
          <img
            class="w-5 h-5 mr-2"
            src="https://www.svgrepo.com/show/355037/google.svg"
            alt="Google Logo"
          />
          Continuar com Google
        </button>
      </div>

      <p class="text-center text-gray-500 text-sm mt-6">
        Ainda não tem conta?
        <!-- LINK PARA A PÁGINA DE CADASTRO -->
        <a href="registerpage.html" class="text-blue-600 hover:text-blue-700 font-medium"
          >Cadastre-se</a
        >
      </p>
    </div>

    <!-- Firebase SDK e Lógica de Login/Recuperação -->
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-auth-compat.js"></script>
    <script>
      // --- CONFIGURAÇÃO DO FIREBASE ---
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      
      const errorFeedbackEl = document.getElementById('feedbackMessage');
      const emailInput = document.getElementById('email');

      // Função para exibir mensagem de erro/sucesso
      function displayFeedback(message, type = 'error') {
        errorFeedbackEl.textContent = message;
        errorFeedbackEl.className = 'error-message mb-4'; // Reset class
        
        if (type === 'success') {
          errorFeedbackEl.classList.remove('error-message', 'text-red-600');
          errorFeedbackEl.classList.add('success-message', 'text-green-800', 'bg-green-100', 'border-green-500');
        } else {
          errorFeedbackEl.classList.remove('success-message', 'text-green-800');
          errorFeedbackEl.classList.add('error-message', 'text-red-600', 'bg-red-100', 'border-red-500');
        }
        errorFeedbackEl.style.display = 'block';
      }
      
      // Mapeia códigos de erro do Firebase para mensagens amigáveis
      function getFriendlyErrorMessage(errorCode) {
        switch (errorCode) {
          case 'auth/user-not-found':
            return "Usuário não encontrado. Verifique o e-mail.";
          case 'auth/wrong-password':
            return "Senha incorreta. Tente novamente.";
          case 'auth/invalid-email':
            return "O e-mail fornecido é inválido.";
          case 'auth/popup-closed-by-user':
            return "Login com Google cancelado.";
          case 'auth/missing-email':
            return "Por favor, insira seu e-mail acima para redefinição.";
          default:
            return "Erro ao acessar: Verifique suas credenciais e tente novamente.";
        }
      }

      // 1. CHECAGEM DE ESTADO (Redirecionamento automático)
      document.body.style.display = 'none'; 
      
      auth.onAuthStateChanged(user => {
        if (user) {
          window.location.href = "dashboard.html";
        } else {
          document.body.style.display = 'flex'; 
        }
      });

      // 2. LOGIN COM E-MAIL/SENHA
      document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        errorFeedbackEl.style.display = 'none'; // Limpa feedbacks
        const email = emailInput.value;
        const password = e.target.password.value;
        
        try {
          await auth.signInWithEmailAndPassword(email, password);
        } catch (error) {
          displayFeedback(getFriendlyErrorMessage(error.code), 'error');
        }
      });

      // 3. LOGIN COM GOOGLE
      document.getElementById("googleLogin").addEventListener("click", async () => {
        errorFeedbackEl.style.display = 'none'; 
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
          await auth.signInWithPopup(provider);
        } catch (error) {
          // Trata o erro de popup fechado ou outro
          if (error.code !== 'auth/popup-closed-by-user') {
            displayFeedback(getFriendlyErrorMessage(error.code), 'error');
          }
        }
      });
      
      // 4. RECUPERAÇÃO DE SENHA (A NOVA FUNCIONALIDADE)
      document.getElementById('forgotPasswordBtn').addEventListener('click', async () => {
        const email = emailInput.value;
        errorFeedbackEl.style.display = 'none'; // Limpa feedbacks

        if (!email) {
          displayFeedback("Por favor, digite seu e-mail no campo acima antes de clicar em 'Esqueci minha senha'.", 'error');
          return;
        }

        try {
          await auth.sendPasswordResetEmail(email);
          displayFeedback(`E-mail de redefinição enviado para ${email}. Verifique sua caixa de entrada!`, 'success');
        } catch (error) {
          console.error("Erro ao enviar redefinição:", error);
          if (error.code === 'auth/user-not-found') {
            displayFeedback("Não encontramos uma conta com este e-mail.", 'error');
          } else if (error.code === 'auth/invalid-email') {
            displayFeedback("O e-mail inserido é inválido.", 'error');
          } else {
            displayFeedback("Ocorreu um erro ao tentar enviar o e-mail de redefinição. Tente novamente.", 'error');
          }
        }
      });

      // *Lembre-se de substituir YOUR_API_KEY, YOUR_AUTH_DOMAIN e YOUR_PROJECT_ID*
    </script>
  </body>
</html>
