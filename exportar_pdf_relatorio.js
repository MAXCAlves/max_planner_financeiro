// Biblioteca: jsPDF + autotable
// CDN (Coloque no seu dashboard_max_planner.html se já não estiver):
// <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
// <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
// --- BASE64 DO LOGO MAX PLANNER FINANCEIRO ---
// String Base64 da logo fornecida pelo usuário.
const LOGO_MAX_PLANNER_BASE64 = 'data:image/jpeg;base64,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 ABPff8A/wDLDDDDDDDDDDDDDDDRgbO70888w282qAGNIHL0//AP8AssMMMMMMMMMMMc/z8H7+jLxpX/ixYgC8NKV33/8AjDDDCDDDDDDDLAXc/B+/t20g5/mXjBAQRT899/8A4wwwwwwwwww1/wD+vz0Hz+nKQqX+hy7EAcdHT33/APDDDDDDDDDDPOQ79 r89B+vpAJAz8rIQBsIjsp09//LDDDDDDDDZ1u39rU9B+ue9c8utOcgw8SAQRc9//APywwwgwww/ffl/a3PQfvRQXPLVDq1yTbpdbPPP/AP8ArDDDDDDD99+/9rU9B+84CY/e9RFSKVp2WyY9/wD/AMMMMMMMMP335f2vz0Ha92w4y3w3+9HaOGEGz7/+8sMMMMMMPf3FjKhzklL+IRlu/eB8T/TfKugBT3//ALrDDDDDDzzjzzjCADD7HzrmUn0ckADSg5fDA99/rLDDDDDDDDDDDDDDDDDDSy288888888sAAAAAA099/LDDzDDDDDDDDDDDDDDDDCC+88888888gAAAAAU9/8A6ww7wwwwwwwwwwwwwwwwtPPPPPP PPCAAAAAMPPf/AMsP8MMMMMMMMMMMMMN77777zzzzzzwAAABwBzz/APjD/8QAAv/aAAwDAQACAAMAAAAQwAAACCCCCCCGO ++62++8JBB19sAC+++DD99hACOoCCCCCCCCGOy++++++uJBBd99wAC+++jX95hACCwACCACCCy2O++++++7hBRd99gAG+ +vDX99BCG+CCCCCCCG2++++++++5jBFd99sAAe++jDV9tACC+SCCCCGC++++z+++zDDBBF999pAC++6DDV99KCyyACCCCSy++6agpzGECBCw39/vADf8AvdigffeSgjjgAggggvvupN/Qg1RLBWi9OVayQbmFEo1/fYQgtvwgggijvscfd/Tg1Z61Ub 1Y0WqwFvygg3/fYQlvvggggjvql/bP/wCoFWP3s5tUPpAQBL1QoP8A99BCS2+CCCC0/sT/APF/4wxY6pcjEQLDG5n0B3yk /fSQFuvggggoFx3/APz/APDDfPMet/rncgAOiR+PiDV99ICCzCCOIU/f/wDxN/4w73TXvatAVKOlYb7nCQsffaQhjggggl P11/7P/wAIPZf9jEi6Xm8jRV+0iUMH30EII4IIIBT+/wD/APF/6y0kwQwh4jzvc5VPT38QAdbSwggggggnfHscMMd6bwe3r7sHZvSKFSb2mNqgwVeaQgggggoQU5Tfr3Xvh0ipU9ZhrQNSQyf6ffgw9aSQggAgggogkvvvvvvrzywQQQXfffbQABPvv ig//SQgsAAAgggggtvvvvvv/wAMEFHX3332AADb76oOX2kEK0AAIIIIIJb7777778kEEFHn330gBDb744IPX0kH4AAAAAB4J777776MMMMMF2H33zwAB76L6IL12EH/xAA4EQACAQICBwQIBQUBAAAAAAABAgMAEQQxBRASEyEycTNBUXIUMDRSYYGxw SJAQlOCFUNwkaGS/9oACAECAQE/AP8AJsejA0asZSCQDwFf0pf3m/0KxeFGHZAHuGB/5r9Jg/cFI6OLqb6ndEF2NhXpUH7g1vPEhszgGlnidtlXBOosFBJNgK9Kg/cFCxp5EjF2awpcRCzBVcEn8mcjUPYx+QatK80PRvtqblbodWBk2XKH9WrHSXcI MhQzpORegrKpXMkjN4mo3KSK3gaBBAIyNEXrEQmKQjuOVYGfaXdnMZVipt7Jw5RlWBgsN4RxOX5FMLiXUMsJIOR4V6Fi/wBhv9ipYpYuDoVJHCoexj8g1aV5oejfbU3K3ShnXGOT4g0JBu9vutevxSy/FjXf86TkXoKxcmxCfE8Kw6bcyisTHsTMPmKw Um3DbvXViYd7GfEZUCVNYeHeyAd3fQAAAH5HDezw+QatLZRfOoexj8g1aV5oejfbU3KelDmHWsZHbYfxHGhORhzH8awUdy7nuFhR5vnSci9BWOk2pAvu1hpkiLEgk1iZ0m2SFIIrBSbMtu5tU8oijLd/dX4mJ7zWGmMUgPcc6BB9cI5WAIjcjxCk1uZ v2ZP/AAaKspsysD8QRWG9nh8i/TVpbKL+VQ9jH5Bq0rzQdG+2puVulDmHWpY95AV+HDVDHu4APhc1+r50GCxBvBaZizE+JpMDGVUlmuRTYCMKSGa9qBKsD3g1G4dFbxFYqbeycOUZVgodldthxOXSsVDupDblPEVgZ7jdseIy9dh+wi8i/TVpT+z86w3 s8PkX6atLZRfyqHsY/INWleaHo321+iQe7q9Gh29rZ43vq9Eg92mRWQqcqGEgBB2dZwkBJOzSxIsewBwr0OD3aAAFSRJI LMKXCwowYA3HroOwi8i/TVpTKL51hvZ4fIurSuUX8qh7GPyDVpXmh6N9tTkhHI901EcVIGKyHh8awk7SAhsxWGkdsRKCxI 46sZM6lEQ2JrBys6MGNyDWNd0VNliLk1BOzwuCfxqDWDkdopCzE2NQYqRZRtsSp4VNI4xUahjYleFY2R0CbLEVFHiw6M0l 161jZJFMYViL0z4qDZZnuDSttKreI9bh+wi8i/TVpT+z86w3s8PkX6atK5RfyqHsY/INWleaDo321Sdm/lNQJO20IzbxrD QboG5uxrDMq4mW5tn9aV1bIg08u1iS9rgGoJNnE5WDd1aQ5Y+pqVWhZXGTr9awPYy1FFvEkAzHEUjl5ob5gqK0hklQQhX Rt8D8L1j+aKirmVUlc2oAAADu9bB2EXkX6atKZQ/OsN7PD5F+mrS2UX8qh7GPyjVpXmg6N9tTC4I8RUMCw7ViTfU2CjZiS x4mosOsQYAnjUMCQ3sSSamw6ysrEkEVNAsoUE5U8KvHsHKoYFiVlBPGoYFhJsSb16JHvd5c53tU0CzWuSLUmCjVla54GpsOspUkkWqXDpKFvwI76AsAPW4Z1MEJDDkFbS+IrSjKTEARfjWGli9Hh/GvIBnW8j99f91pR1bdgMCbGoCDDEQf0DVpUgvCL 9zajwU9Kw8jOwvNc24randhNGoyIN6xEzxvHs5d4qOUvM4B/DsgisRK62VM8/kKRgyKw7xSYlryBvjsnpUchMKu2drmlOJdBIGHHJamdkhdhmBWHcsDeTa+WVK7Gdk7goNTyuspUSBQFvxqKQtCrtna5pTiHTeBwO8Con3kata1/W2HgKsPAarDwFWX wFDhlqvrIuCKij3aBeFx300ZMqPflBp4tqRHvwUHh1qHD7qR2B4HIU2HDyMzscrADhUMZjTZvfjwo4a8bqTxLEg+FJHsxB Dx4WrcTAbAlGx/2pU242QHMVEkiizFT4WFCMiZnvmoFSYcSOzE5rYUinYCtxNrGtxMoKLINj/oqNAiBRkP8S//xAA3EQACAQICBgcHBAIDAAAAAAABAgMAEQQSECExMkFRBRMUM3FygjBDUmGBscEiQEJTFXCSoaL/2gAIAQMBAT8A/wBmCn6QYMwEYsDX+Rf+tawuJM4e6gFbbPnp7PP8Bp0dDZhbQiM5soua7NP8GlIZXF1UkU0MqqSVIGhVLEAbTXZp/gogg2NJG7myi9NBKoJ KWH7MbRT77eJ0dG+/9H50LvL46MYmZM3LRg0shbnRp99vGtpAqNQiKvIU6h0ZeYogqSDQJBBFQSiRAePGsZDY5xx21hora j17TtrGTXPVj6/sWxWHRirSAEbdRNdswv8Ab/5aopYpdx81tvD70++/mOjo33/o/Ohd5fGuFanUjmKMZ63J87VqRByArhT 77eNYVM0o5CpnyRsagfPEprFpllvz0YeXq3HI7a1EVNKI4yePCiSSSf2M3fS+dvvo6M35fBaffbxOjo33/o/Ohd4eNHZWGkvnXkaMI67P8qxT2CpzNfx+lPvt4msGmWPNzqeJpVABtWHhaIEE3BrFpmiJ4jRBEZHA4ca1KKniEiEceFEEGx9sZYlJBl QEbQWArroP7o/+YpWRtasreBBqbvpfO330dGb8vpp99vE6Ojff+j86F3l8aOyo3yT34XsdEr55r/OwrhRXNKRzalAVQOQpsawYgKLA0uNYsAUFqIBFSIVkK/OsPF1afM7axc12yA7NtYeXrIweI21jIbHrB9faipe9k8x++jo3el8BU3fS+dvvo6M35P TT77eY6Ojff+j86e1Tc6JJrtMuW2bR2qbnSuytmG2u1Tc9PapgN6jI5cOTrrtU3xUSSSTUcrxklTTYmVlIJ1H2oqXvH8x0dG70vgKm76Xzt99HRm/J6affbzHR0b7/ANH50JrdPMKcYdMoZBr+VYmFUsy7DWJjRYUIUA3GjCRKwZmF6xcSqylRYEVg0 Vi+YA1LAFmQgfpYisUiK8eVQL1Nh0aM5VANRRocM5Ki9mrBojZsyg1K+GyuoTX4Vg0RlcsoNjQTDTZlVbEU65WZeR9oKl7 x/MdHRu9L4Cpu+l87ffR0Zvyemn328x0dG+/9H50R94nmFStCuUuPCsRP1hAA1CsSrNCgA4imR12giljywBL2NqnjzQcyK wO2T6VE4kDKdqtWL7yKpJMjJfYdRp1CxS24gmsD/KppGKOOq+tYLckoMojZ40F6Ykkk7T7QVL3knmOjo3el8BU3fS+dvvo6M35fTT77eY6Ojff+j86AbMDyNSzNLluBq0DGOABlFSYhnKkgajUs7SgAjZUU7RqQACDUUxjLEAa6SZkkLipZ2kZSRsqW dpQLi1q7U/V5Pla9QzNFewpsW7KRYaxUU7RBgANdR4h482w3pjck+1m1TSA/GauK6NBvKeFhU6OJpbqd8/esrcjXRqsDKS CB+mpNUjg/EdHRuyf0fnQouyj51PGqKbRW5NelRTBI3EEVh4kkR77eBqWIJChIs1zesPGjXZ9mynXK5XlT4dP0FRyzCpEH XFF2Xo9nVshU+aoVVplU6xesQgW1o8tFF7OjW1ljUMaGJSYyxJqWMCYovMURh0cRlCeZqVMjlfa3PM1mb4jVydprMedZm 5mrk0ddWGlTZgeRqWQu5Oux4UsgETpbaRSSZY3XiSKln6xEFtY2mlnKRqqgfMmppBI+YC2rXXabSKwGrLYine8pcatd666 EnOYzm/6qN8kocjYameN9ahvqaMgMKpbWDeo8RkRFA2Nrp2BkLLq13FddCSHaM56dy7ljx/1L/8QARBAAAQIDAgsDCQgAB QUAAAAAAQIDAAQRBTEQEhMgITIzQVFxciKBkRQVNEJSU2GSsSM1QFBzocHRJFRjgpAGQ2Biov/aAAgBAQABPwL/AJFktuK 1UKPIRkX/HS/CMi97pfhGRf90vwhTTqRVTagOX/hLWya6BmC/OFizvBHzR5knuCPmiZs6Zlm8dwClaaDmy1nzM0gqbAoDTSY8yT3BHzR5lnuCPmzWGHJhwNtjTHmSe4I+aPMk9wR80TEs7LuYjg00rmMMqecDaaVN1Y8yz3BHzR5lnuCPmihF+GWs2 amW8ogCld5jzJPcEfNE1JuyuKHMWp3A/kzeyb6BmC8ZpuMI1E8sE0wH5dxs+sIIIJBvGHTuiSY8nlmm+A088Crjm2Cxodf PSMNvS+M0h4eqaHkcwEggg6RdEhNial0r9a5Q+OC25PJuZdI7K9bnglZdcw+hpO+88BDbaW0JQkUAFBDjiWm1LUaBIqYmp hUw+t1W+4cB+TN7JvoGYLxmm4wjVTyw2zL5KcKgOy5p79+GyZfLTiajso7R/jCrVOZyiTYyEs03wGnnC1BCFKNwFTDbiX EJWm5QqIfaDzLjZ9YUhSVIUUqvBocyzZzyWYBOorQr+8DzSHmltruUIfZUw8ttd6TFkSeQYx1jtr/AGHDBbc5jK8nSdA0r 58PydvZN9AzBeM03GEaieUOryba1+yknwhCwtKVC4isWxL5WTUQO032v7w2JL5OVyhGlw17t0OuBttaz6qSfCG1FSEqIvEK1TBw2Uxlp1vgjtHuwWw/kpJQF6+zFhv48pk66WzTuwW0xk5vHA0OCvfm2LO5RvIrPaRd8RgmbPamHmXVeodPxwT80JWXUvfckfGCSSSTUm8/kLMqpxONjBI3R5D/AKo8I8h/1R4R5D/qjwjyFW5wV5Qd8N7JvoGYm8ZpuMI1E8omNg70K+kWHM5SVyZvb0d26CKjTE2xkJl1rgdHKGWi8820PWVSEJCEhIuAi3pjElg0L3PoIa2aOkQrVOZYTGLLrd3rOjkMFuv48ylv3af3MWM/ k5wJ3OCnfgtmXysoVAaW+13b81h5bLqHEXpMS7yH2kOIOgjDac55TMGmojQn+/yJjYNdGYLxDmsvmYb2TfQMxN4zTcYRqJ5RMejvdB+kWXMZCbb9lfZOC3pfZvjpV/EWDL4zjjx9XsjBakxl5p07k9lPdDOyR0iFXHClJWpKReo0HfDLYaaQ2LkikKUEpKjcBUw84XXVuH1lEwlRQoKF6TUd0MuB1pDguUmsKSFJINxvh9osvONn1VUzACogAVJ0CJGVErLpb33q54CAQQbjE/KGV fKPVvSfh+RMbBrpzBeIc1l8zDeyb6BmJvGabjCNRPKJjYO9BjdFmzPlEohR1hoVzETTGXl3W+KYkJfyeVaQb6drnFoTHk8 o4vfcnmYNxhnZI6RCtU4bFYyk3j7mxXvOBxtLiFIVcRQx5nkPdf8A0Y8zyHuj8xhhlthsNoHZGC3pfFdbeHrCh5jMsOTqfKVDQNCP7wP2gyzMssm9f7cMFoyYmpcp9caUmCCDQjT+QsbBroGYLxDmsvmYb2TfQMxN4zTceUI1E8omNg70GNwiw5nEmC0 bnLuYw27MYzyGQdCBU8zBuMM7JHSIVqnDYzGSkwo3udrA9akkw4W3HKKHwMeerO98flMeerO98flMNWpJPOJbQ72jdoOC0mMvJup3gYw5jDKSypl9LQ33ngIbQltCUJGgCgiYeQwytxVyRDzq3nVuLvUYsmc8oYoo9tGg/wB4LbksVXlCBoOvz4/i0M OuCqUEiPJJj3f7iPJJj3f7iPJJj3f7iDLTAFS2cDGwa6MwXiHNZfMw3sm+gZibxmm4wjUTyiY2DvQY3QhakKStN6TUQw6l5lDiblCsOLCEKWbkiph51Trq3FXqNYNxhnZN9IhWqcDDReebaHrKpCQEgAQtQQlSjcBUw64XXFuG9SicKFltaVi9Jr4Q04 HG0LFyhXBPsZCbdRurUcjgsmS8nYxlD7Rek/1gtucyjuQSeyjW6sEnNKlX0uC71h8IQpK0hSTUG6HG0uIUhQqCKGJuWVLPqbPceI/FM7FroGYLxC9dXUYY2DXQMwXiHNZfMw3sm+gZgvGcLedAH2CfGF266tCk5FOkUvwydquyrOSyYUK6NMTdruzLC msmlIN+nCm3nUpAyCdA4wbfdpsE/NglJnyV7KBAUaUFY8/ve4R4xMWy6+ytrJhONvBzZW13ZdhLWTCqXEmPP73uEeMTs75WUKLYSQKVrDDgadQsoxsU1pHn973CPGDb71D9inxgknSTpwylrPSzWTxAoC6pjz+77hPzRO2h5WE4zKQR61fxTOxa6BmC8 QvaL6jDGwa6MwXiHNZfMw3sm+gZgvH56zsWugZgvEL2i+owxsGugZgvEOay+ZhvZN9AzE3jNbTjLQnioDxjzAz75fgIVY CN0wrwics9+U19KTcoYJGyWpmWQ6XFAmvCH28m86gHVWR4ZklYyX5ZDq3FJKtNPhFpWaJRLakqKgTQ1wyljtPy7TpdWMYV 3RaMiZNwCtUqGgw2nHdbT7SwPGJ2yGpeVcdDqiU04ccCbBYIByy/2ibllSz6mz3HiIkmBMTKGiSAaxaNmNyjAWlxR7dNOBmxGXGW15ZelIO6PMDPvl/tFpWciUS2UrUcY743QLBZIByy/wBoNgNbn1+Aicsl+WTjg46N5F4/FM7FroGYLxC9ovqMMbBr ozBeIc1l8zDeyb6BmJvGaxtmutP1iZUpEs8pJ0hskQi159CgS7jjekgQ4lEzKqG5aMFjfdzPf9YnPS5j9VX1wtNl11DY9Y0iYcErJrUPURoicbE3IKxdNU4ycNmegS/RE5LonZUhJHFB+MMgiaYBGnLJ+sWv93THd9YNxhJAbBNwTFrymXl8qjWRp5i LJ9PZ74t70NH6o+kbjEn6Ix0CPOlo/wCYPgIem5l8AOulVLtAg3GFEhgkex/EC1bQqP8AEfsIkn/KpRDik6w0iJhAbmHkC5KyB+JZ2LXQMwXiF7RfUYY2DXQMwXiF6y+ZhvZN9AzBeM1jbNdafrDreVZcbrTGSR4wj/p9GMMd8kcKUifmUSsqrjSiBgs b7uZ7/rE56XM/qq+uGw2MeZU4bkDRzMW+/RLTNbzjHuixH8pKYldLZp3RaDGQm3Ubq1HI4LM9Al+iLHm/tHZY+0oo/qLT k8Sdln0jQt1GNzrFr/dz/d9YNxhfoyv0/wCIsSbyrORVrIu5QmT8mthqg7C8Yp/qLe9DR+qPpG4xJ+iMdAjyOzPdNRbDMs 3kcihI1q0g3GKYzVOKYFgy291z9oddl5GW4JSOyOMOLLi1LN6jU9/4lnYtdAzBeIXtF9RhjYNdGYLxC9ZfMw1sm+gZgvGaxtmutP1iYWpEu6tN4QSINrz5/wC6B/thx1x1WM4sqPxwWL93M9/1ialJtU0+RLukFxWnFgyc2ASZZ2g/9cFkMZKSRxX2j3 w5O2WVnKLaJGjSIYm7OLmIypvGVwF8W+xVDTw3dk9+CzPQJfojKLamCtOslwkeMNLanJZCvVND3iLX+7n/7vWnfC/Rlfp/wAIiVfVLvNunh3X/EQnJPJad0Hejzi3vQ0fqj6RuMSfujHQI8im/5R35IXLvtaqthKB8RSDcYVsD0fxFj2g4Xci8snG1SePC LclDolMvJ/7/Euxa6BmC8QvaL6jDGwa6MwXiHNZfMw3sm+gZgvGa2QlxBJuKB/eJi1pNcuxQCpVSgnZOcWp1pysvJttsrGFdxjz1I8V/KYftiTWy6kFVSgjVMIxcZIVq1FeULtmUDKw2VY2L2eycDTim3ELHqqBiZtOQfl3GypXaT7JvwSVqSjMqy2 oqqE6eyYcIK1kb1GLKtASpPor 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`;

const LOGO_WIDTH = 30; // Largura do logo no PDF (em mm)
const LOGO_HEIGHT = 10; // Altura do logo no PDF (em mm)

window.gerarRelatorioPDF = function () {
    // 1. OBTEM DADOS REAIS DO DASHBOARD
    // Assume-se que 'userFinancialData' está definida e populada no dashboard_max_planner.html
    const data = window.userFinancialData || {}; 

    // Calcula os totais (com fallback para zero)
    const receitasMensais = data.monthlyIncome || [];
    const despesasMensais = data.monthlyExpenses || [];
    const investimentoPorTipo = data.investmentDistribution || {};
    // Assumimos que você tem uma propriedade 'detailedTransactions' no Firestore
    const lancamentosDetalhados = data.detailedTransactions || []; 

    const totalReceitas = receitasMensais.reduce((a, b) => a + b, 0);
    const totalDespesas = despesasMensais.reduce((a, b) => a + b, 0);
    const totalInvestido = Object.values(investimentoPorTipo).reduce((a, b) => a + b, 0);
    const saldoDisponivel = totalReceitas - totalDespesas;

    
    // Configurações do PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const dataAtual = new Date().toLocaleDateString('pt-BR');
    let currentY = 10; // Posição Y inicial (cabeçalho)

    // --- 2. CABEÇALHO PROFISSIONAL (Logo e Título) ---
    try {
        // Adiciona a logo JPEG Base64
        doc.addImage(LOGO_MAX_PLANNER_BASE64, 'JPEG', 10, currentY, LOGO_WIDTH, LOGO_HEIGHT);
    } catch (e) {
        console.error("Erro ao adicionar o logo. Verifique o Base64 ou o tipo de imagem.", e);
    }
    
    // Título alinhado ao lado do logo
    doc.setFontSize(18);
    doc.setTextColor(30, 58, 138); // Azul Profundo (#1E3A8A) - Cor corporativa
    doc.text("Relatório Financeiro", 45, currentY + 7); // 45mm após o logo
    
    currentY += 20; // Move para a próxima seção

    // --- 3. SEÇÃO RESUMO GERAL ---
    doc.setFontSize(10);
    doc.setTextColor(100, 100, 100);
    doc.text(`Relatório Gerado em: ${dataAtual}`, 10, currentY);
    currentY += 8;

    doc.setFontSize(14);
    doc.setTextColor(33, 37, 41);
    doc.text("Resumo Geral:", 10, currentY);
    currentY += 8;

    // Indicadores com cores corporativas
    doc.setFontSize(12);
    doc.setTextColor(34, 197, 94); // Verde (Receitas)
    doc.text(`Receitas Totais: R$ ${totalReceitas.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`, 15, currentY);
    currentY += 7;
    
    doc.setTextColor(239, 68, 68); // Vermelho (Despesas)
    doc.text(`Despesas Totais: R$ ${totalDespesas.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`, 15, currentY);
    currentY += 7;
    
    doc.setTextColor(251, 191, 36); // Dourado (Investimentos)
    doc.text(`Saldo Investido: R$ ${totalInvestido.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`, 15, currentY);
    currentY += 7;

    doc.setFontSize(14);
    doc.setTextColor(59, 130, 246); // Azul (Destaque Final)
    doc.text(`Saldo Disponível: R$ ${saldoDisponivel.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`, 15, currentY);
    currentY += 12;

    // --- 4. TABELA DE LANÇAMENTOS DETALHADOS (Autotable) ---
    doc.setFontSize(14);
    doc.setTextColor(33, 37, 41);
    doc.text("Detalhe dos Lançamentos:", 10, currentY);
    currentY += 5;

    // Formata os dados de lançamentos para a tabela, garantindo o formato de moeda
    const bodyTable = lancamentosDetalhados.map(item => [
        item.data, 
        item.tipo, 
        item.categoria, 
        // Formatação de moeda
        `R$ ${item.valor ? item.valor.toLocaleString('pt-BR', { minimumFractionDigits: 2 }) : '0,00'}`,
        `R$ ${item.saldoInvestido ? item.saldoInvestido.toLocaleString('pt-BR', { minimumFractionDigits: 2 }) : '0,00'}`
    ]);

    doc.autoTable({
        startY: currentY,
        head: [["Data", "Tipo", "Categoria", "Valor", "Saldo Investido"]],
        body: bodyTable,
        styles: { fontSize: 10, cellPadding: 2 },
        headStyles: { fillColor: [30, 58, 138], textColor: [255, 255, 255] }, // Azul Profundo
        margin: { top: 10 }
    });
    
    // --- 5. RODAPÉ INSTITUCIONAL ---
    const pageHeight = doc.internal.pageSize.height;
    doc.setFontSize(8);
    doc.setTextColor(150, 150, 150);
    doc.text('MAX PLANNER FINANCEIRO: Seu futuro financeiro começa agora.', 105, pageHeight - 10, { align: "center" });

    // --- 6. EXPORTAR ---
    doc.save("Relatorio_MaxPlanner_" + dataAtual.replace(/\//g, '-') + ".pdf");
};